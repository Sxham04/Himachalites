<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Himachalites</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="style4.css">
    <link rel="icon" type="image/png" href="img/Frame 9.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            opacity: 0;
            transition: opacity 0.4s ease-in;
        }
        @media (max-width: 1024px) {
            .dashed-line {
                display: none;
            }
        }
        #scrollToBottomBtn.is-hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: scale(0.5);
            transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
        }
        .altitude-unit {
            font-weight: 500;
            margin-left: 0.2em;
        }
        
        #svg-tip-counter {
            position: absolute;
            top: 0; /* Updated by JS */
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #333;
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-weight: 600;
            z-index: 10;
            white-space: nowrap;
            opacity: 0;
            transition: top 0.05s linear, opacity 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="top-content-wrapper">
        <div class="dashed-line">
            <div id="svg-tip-counter">0 ft</div>
            <svg
                class="dashed-line-center"
                viewBox="0 0 1654 8888"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                role="img"
                aria-labelledby="line-title"
                preserveAspectRatio="xMidYMin meet">
                <title id="line-title">Decorative dashed line</title>
                <defs>
                    <mask id="line-mask">
                        <rect id="mask-rect" x="0" y="0" width="1654" height="8888" fill="white" />
                    </mask>
                </defs>
                <path
                    id="Line"
                    mask="url(#line-mask)"
                    d="M906.969 1C927.969 251.167 882.369 739.8 531.969 693C181.569 646.2 38.9691 881.5 11.4691 1005C-23.8642 1195.83 11.6691 1569.7 436.469 1538.5C861.269 1507.3 951.802 1844.83 943.969 2017.5C943.969 2128 986.469 2351.2 1156.47 2360C1368.97 2371 1505.47 2483.5 1511.97 2748C1518.47 3012.5 1123.97 3114.5 943.969 3184C763.969 3253.5 893.969 3782.5 556.005 3806.05C218.041 3829.6 43.9691 3927.5 43.9691 4276.5C43.9691 4555.7 283.969 4572.17 403.969 4545.5C562.969 4521.67 879.669 4559 874.469 4899C869.269 5239 972.969 5359.5 1114.47 5359.5C1249.64 5368.17 1638.87 5455.2 1652.47 5712C1666.07 5968.8 1326.8 6044.33 1240.97 6056.5C1125.3 6087.67 927.469 6224.5 902.818 6488.23C871.331 6825.11 748.969 6939 425.969 6937C102.969 6935 26.9691 7073.5 28.9691 7429C30.9691 7784.5 526.995 7702.6 719.969 7739.5C879.469 7770 919.469 8027 909.469 8129.5C907.302 8249.5 840.043 8483.87 588.34 8461.35C336.638 8438.83 162.55 8558.9 116.469 8619.5C96.6358 8647.83 79.3691 8737.5 92.9691 8887.5"
                    stroke="black"
                    stroke-width="2"
                    stroke-dasharray="7 7" />
            </svg>
        </div>

        <div class="state-content-sections">
            <section class="state-container state-container--split reverse state-container-1">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/ls-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="25069">24,569</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-1">Lahaul & Spiti</h2>
                    <p>Lahaul & Spiti is a high-altitude district in the trans-Himalayan region of Himachal Pradesh, known for its stark landscapes and ancient monasteries. Formed by merging two valleys—Lahaul and Spiti—the district offers unique cultural and ecological experiences. Places like Key Monastery, Chandratal Lake, and Tabo Monastery draw adventurers and spiritual seekers.
                    <br><b>Quick Facts:</b>
                    <br>• Tabo Monastery, founded in 996 AD, is one of the oldest functioning Buddhist monasteries in India.
                    <br>• One of the driest and coldest inhabited regions in the country.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/lh.png" alt="Scenic view of Lahaul & Spiti">
                </div>
            </section>
            
            <section class="state-container state-container--split state-container-2">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/kinaur-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="22362">21,862</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-2">Kinnaur</h2>
                    <p>Kinnaur, located in the northeastern corner of Himachal Pradesh, is known for its rugged mountains, apple orchards, and tribal culture. Bordering Tibet, it blends Buddhist and Hindu traditions, evident in monasteries and temples like Kinnaur Kailash and Mathi Devi. Its dramatic terrain attracts trekkers, pilgrims, and culture seekers alike.
                    <br><b>Quick Facts:</b>
                    <br>• Kinnaur Kailash is considered sacred by both Hindus and Buddhists.
                    <br>• One of the least populated yet highest literacy districts in the state.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Kin.png" alt="Scenic view of Kinnaur">
                </div>
            </section>

            <section class="state-container state-container--split reverse state-container-3">
                 <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/chamba-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="21759">21,259</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-3">Chamba</h2>
                    <p>Chamba district, located in the northwestern part of Himachal Pradesh, is known for its scenic beauty, ancient temples, and rich cultural heritage. Nestled amidst the Himalayas, it lies on the banks of the Ravi River. Chamba is famous for its traditional miniature paintings, fairs like Minjar, and architectural marvels such as the Lakshmi Narayan temples. The district also offers access to serene valleys like Bharmour and Pangi, making it a peaceful and culturally vibrant destination.
                    <br><b>Quick Facts:</b>
                    <br>• Hosts the centuries-old Minjar Mela festival.
                    <br>• Bhuri Singh Museum preserves royal art and artifacts of Chamba.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/cha.png" alt="Scenic view of Chamba">
                </div>
            </section>

            <section class="state-container state-container--split state-container-4">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/kullu-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="21138">20,638</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-4">Kullu</h2>
                    <p>Kullu district, nestled in the middle Himalayas, is known for its breathtaking valleys, apple orchards, and vibrant festivals. Located along the Beas River, it serves as the gateway to the higher Himalayan regions, including Manali and the Great Himalayan National Park. Kullu is also renowned for its woolen shawls and Dussehra celebrations.
                    <br><b>Quick Facts:</b>
                    <br>• Hosts the internationally famed Kullu Dussehra festival.
                    <br>• Great Himalayan National Park is a UNESCO World Heritage Site.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Kul.png" alt="Scenic view of Kullu">
                </div>
            </section>

            <section class="state-container state-container--split reverse state-container-5">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/shimla-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="18069">17,569</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-5">Shimla</h2>
                    <p>Shimla, the capital district of Himachal Pradesh, is a blend of colonial heritage and scenic beauty. Once the summer capital of British India, Shimla now serves as an administrative, educational, and tourism hub. With pine forests, heritage buildings, and bustling bazaars, it attracts visitors year-round. The Kalka–Shimla railway is a UNESCO World Heritage site.
                    <br><b>Quick Facts:</b>
                    <br>• Shimla is one of India’s most popular hill stations.
                    <br>• Home to the historic Viceregal Lodge and Asia’s only natural ice skating rink.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Shm.png" alt="Scenic view of Shimla">
                </div>
            </section>

            <section class="state-container state-container--split state-container-6">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/kangra-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="16341">15,841</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-6">Kangra</h2>
                    <p>Kangra is the largest district of Himachal Pradesh, located in the western part of the state. Rich in history and art, it is home to the ancient Kangra Fort and world-renowned miniature paintings. The district spans from the plains near Gaggal to the Dhauladhar ranges near Dharamshala, which also serves as the winter capital of Himachal Pradesh.
                    <br><b>Quick Facts:</b>
                    <br>• Home to McLeodganj, the seat of the Tibetan government-in-exile.
                    <br>• Known for Kangra tea, with GI tag recognition.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Kang.png" alt="Scenic view of Kangra">
                </div>
            </section>

            <section class="state-container state-container--split reverse state-container-7">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/sirmaur-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="11965">11,465</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-7">Sirmaur</h2>
                    <p>Sirmaur district, located in the southeastern part of Himachal Pradesh, is known for its lush green landscapes, fertile valleys, and cultural richness. With its headquarters in Nahan, the district is home to historic towns, ancient temples, and peaceful hill stations. It is famous for Renuka Lake, the largest natural lake in the state, and the annual Renuka Fair. Sirmaur also produces high-quality fruits like apples and peaches, and has growing industrial hubs like Paonta Sahib, a major religious and economic center.
                    <br><b>Quick Facts:</b>
                    <br>• Leading producer of peaches in Himachal Pradesh.
                    <br>• Renuka Lake is the largest natural lake in the state.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/SIr.png" alt="Scenic view of Sirmaur">
                </div>
            </section>

            <section class="state-container state-container--split state-container-8">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/mandi-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="11123">10,623</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-8">Mandi</h2>
                    <p>Mandi lies in the heart of Himachal Pradesh and is often referred to as the "Chhoti Kashi" for its numerous ancient temples. The district is a cultural and logistical link between Kullu and Kangra valleys. Mandi is also an emerging education center with institutions like IIT Mandi. With the Beas River flowing through, it boasts lush valleys, historical architecture, and religious significance.
                    <br><b>Quick Facts:</b>
                    <br>• Home to over 80 old stone temples with intricate carvings.
                    <br>• Hosts the week-long International Shivratri Fair every spring.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Man.png" alt="Scenic view of Mandi">
                </div>
            </section>

            <section class="state-container state-container--split reverse state-container-9">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/solan-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="8018">7,518</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-9">Solan</h2>
                    <p>Solan is a district in the south-central region of Himachal Pradesh, often called the "Mushroom City of India" due to its high mushroom production. Located along the Chandigarh–Shimla highway, Solan is an important industrial and educational hub. It houses institutions like Dr. Y.S. Parmar University and attracts tourists with sites like Shoolini Mata Temple and Kasauli. With its mix of plains and hills, Solan plays a key role in connecting the hills with nearby metropolitan areas.
                    <br><b>Quick Facts:</b> <br>• Known for the oldest brewery in India, established in Kasauli in 1855. <br>• Hosts Shoolini fair, one of the most vibrant local festivals.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Sol.png" alt="Scenic view of Solan">
                </div>
            </section>

            <section class="state-container state-container--split state-container-10">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/bilaspur-icon(1).png" alt="District Icon">
                        <span class="altitude-value" data-final-value="6496">5,996</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-10">Bilaspur</h2>
                    <p>Bilaspur is a district in the southwestern part of Himachal Pradesh, situated along the banks of the Sutlej River. Known as the first planned hill town of independent India, Bilaspur was re-established in 1954 after the original town was submerged during the construction of the Bhakra Dam. The district has a rich cultural heritage and is famous for the Naina Devi Temple, one of the most revered Shakti Peeths. With its mix of historical significance, pilgrimage sites, and proximity to major highways, Bilaspur serves as a vital link between Himachal and the neighboring plains of Punjab.
                    <br><b>Quick Facts:</b>
                    <br>• Home to the Bhakra Dam, one of India’s highest gravity dams.
                    <br>• Hosts the annual Nalwari fair, celebrating cattle trade and local culture.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Bil.png" alt="Scenic view of Bilaspur">
                </div>
            </section>

            <section class="state-container state-container--split reverse state-container-11">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/hamirpur-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="4101">3,601</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-11">Hamirpur</h2>
                    <p>Hamirpur is a district in the western part of Himachal Pradesh, known for its hilly terrain and high literacy rate. Bordered by Kangra, Mandi, and Bilaspur, it is the smallest district in the state by area. Hamirpur was carved out of Kangra district in 1972 and has a strong tradition of military service, with a large number of its residents serving in the Indian armed forces. The district is culturally rooted, with temples like Deotsidh (Baba Balak Nath) attracting thousands of pilgrims. With well-developed road networks and educational institutions, Hamirpur is emerging as a knowledge and service hub in Himachal.
                    <br><b>Quick Facts:</b>
                    <br>• Hamirpur has one of the highest literacy rates in Himachal Pradesh.
                    <br>• Known as the “Veer Bhoomi” for its large number of army personnel.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column">
                    <img src="img/Hamir.png" alt="Scenic view of Hamirpur">
                </div>
            </section>

            <section class="state-container state-container--split state-container-12">
                <div class="info-column">
                    <div class="h2-popup">
                        <img src="icons/una-icon.png" alt="District Icon">
                        <span class="altitude-value" data-final-value="3937">3,437</span><span class="altitude-unit"> ft</span>
                    </div>
                    <h2 class="header-12">Una</h2>
                    <p>Una is a district in the southwestern part of Himachal Pradesh, bordering Punjab. Known for its mix of plains and low hills, Una serves as a gateway to the state. It was carved out of Kangra district in 1972 and has a strong agricultural base, with growing industrial activity. The district is culturally rich, home to important religious sites like the Chintpurni Temple. With good road and rail connectivity, Una plays a key role in linking Himachal to the plains of northern India.
                    <br><b>Quick Facts:</b>
                    <br>• Chintpurni Temple is one of the prominent Shakti Peeths in North India.
                    <br>• Una is one of the few districts in Himachal with a broad-gauge railway line.</p>
                    <a href="#" class="info-button">Explore</a>
                </div>
                <div class="image-column image-12">
                    <img src="img/image 2.png" alt="Scenic view of Una">
                </div>
            </section>
        </div> 
        <div class="content-section-spacer"></div> 
    </div> 
    <div id="landing-page-container">
        <header>
            <div class="top-bar">
                <p>Keep Himalayas Clean & Plastic Free</p>
                <div class="social-links">
                    <a href="#" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#" aria-label="Facebook"><i class="fa-brands fa-facebook"></i></a>
                </div>
            </div>
            <nav class="navbar">
                <ul class="main-nav nav-left">
                    <li><a href="#" class="active">Home</a></li>
                    <li><a href="#">Gallery</a></li>
                    <li><a href="#">About</a></li>
                </ul>
                <div class="logo">
                    <img src="img/Frame 9.png" alt="Himachalites Logo">
                </div>
                <ul class="main-nav nav-right">
                    <li><a href="#">News</a></li>
                    <li><a href="#">Packages</a></li>
                    <li><a href="#">Contact Us</a></li>
                </ul>
                <button class="mobile-menu-button" id="mobile-menu-toggle" aria-label="Toggle Menu" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </header>

        <main class="content-area">
        </main>

        <div class="bottom-image">
            <img src="img/Frame 15.png" alt="Scenic background image">
        </div>
    </div>

    <a href="#landing-page-container" id="scrollToBottomBtn" title="Go to Landing Page">
        <i class="fas fa-arrow-down"></i>
    </a>

<script>
    const navbar = document.querySelector('.navbar');
    const landingPage = document.getElementById('landing-page-container');
    const scrollToTopBtn = document.getElementById('scrollToBottomBtn');
    const maskRect = document.getElementById("mask-rect");
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const svgLine = document.querySelector(".dashed-line-center");
    const topContentWrapper = document.querySelector('.top-content-wrapper');
    const dashedLineContainer = document.querySelector('.dashed-line');
    const stateContainers = document.querySelectorAll('.state-container');
    let lastScrollTop = 0;
    let isSlowing = false;
    let lastTouchY = 0;
    const scrollBlockingKeys = ['ArrowUp', 'ArrowDown', ' ', 'PageUp', 'PageDown'];
    let isBouncingTop = false;
    let isBouncingBottom = false;

    const svgTipCounter = document.getElementById('svg-tip-counter');
    const pathElement = document.getElementById('Line');
    let pathTotalLength = 0;
    let checkpointsData = [];
    let currentCounterY = 0;

    function updateMainCounter() {
        if (!checkpointsData.length || !svgTipCounter) return;
        
        let prevCheckpoint = checkpointsData[0];
        let nextCheckpoint = checkpointsData[0];
        for (let i = 0; i < checkpointsData.length; i++) {
            if (checkpointsData[i].y <= currentCounterY) {
                prevCheckpoint = checkpointsData[i];
            } else {
                nextCheckpoint = checkpointsData[i];
                break;
            }
        }
        if (prevCheckpoint === nextCheckpoint) {
             nextCheckpoint = checkpointsData[checkpointsData.length - 1];
        }
        const distanceBetweenPoints = nextCheckpoint.y - prevCheckpoint.y;
        const valueRange = nextCheckpoint.value - prevCheckpoint.value;
        let progress = 0;
        if (distanceBetweenPoints > 0) {
            progress = (currentCounterY - prevCheckpoint.y) / distanceBetweenPoints;
        }
        if (currentCounterY >= checkpointsData[checkpointsData.length - 1].y) {
            progress = 1;
        }
        const currentValue = prevCheckpoint.value + (progress * valueRange);
        
        svgTipCounter.textContent = `${Math.round(currentValue).toLocaleString('en-US')} ft`;
    }

    function animateAltitude(element) {
        const finalValue = parseInt(element.dataset.finalValue, 10);
        if (isNaN(finalValue) || element.dataset.animated) return;
        element.dataset.animated = 'true';
        const startValue = parseInt(element.textContent.replace(/,/g, ''), 10);
        const duration = 1500;
        let startTime = null;
        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / duration, 1);
            const easedProgress = 1 - Math.pow(1 - progress, 3);
            const currentValue = Math.floor(easedProgress * (finalValue - startValue) + startValue);
            element.textContent = currentValue.toLocaleString('en-US');
            if (progress < 1) {
                requestAnimationFrame(step);
            } else {
                element.textContent = finalValue.toLocaleString('en-US');
            }
        }
        requestAnimationFrame(step);
    }
    function updateNavLayout() {
        const isMobile = window.innerWidth <= 1024;
        const navLeft = document.querySelector('.nav-left');
        const navRight = document.querySelector('.nav-right');
        if (isMobile) {
            if (navRight && navRight.children.length > 0) {
                while (navRight.firstElementChild) {
                    navLeft.appendChild(navRight.firstElementChild);
                }
            }
            if (navRight) navRight.style.display = 'none';
        } else {
            if (navRight) navRight.style.display = 'flex';
        }
    }
    function updateSvgHeight() {
        if (svgLine) return svgLine.getBoundingClientRect().height;
        return 0;
    }
    function positionDashedLine() {
        if (window.innerWidth <= 1024) return;
        const stateContainer1 = document.querySelector('.state-container-1');
        const stateContainer12 = document.querySelector('.state-container-12');
        if (!stateContainer1 || !stateContainer12 || !topContentWrapper || !dashedLineContainer) return;
        const topContentWrapperRect = topContentWrapper.getBoundingClientRect();
        const state1Rect = stateContainer1.getBoundingClientRect();
        const state12Rect = stateContainer12.getBoundingClientRect();
        const offset = 0;
        const actualDashedLineTop = (state1Rect.top - topContentWrapperRect.top) - offset;
        const state12MiddleY = (state12Rect.top + state12Rect.bottom) / 2;
        const actualDashedLineHeight = (state12MiddleY - state1Rect.top);
        dashedLineContainer.style.top = `${actualDashedLineTop}px`;
        dashedLineContainer.style.height = `${actualDashedLineHeight}px`;
    }
    
    function animateDashedLine() {
        if (window.innerWidth <= 1024 || !maskRect || !svgLine || !dashedLineContainer || !pathElement || pathTotalLength === 0) {
            if (svgTipCounter) svgTipCounter.style.opacity = '0';
            return;
        }

        const svgDynamicHeight = updateSvgHeight();
        if (svgDynamicHeight === 0) return;
        
        const dashedLineRect = dashedLineContainer.getBoundingClientRect();
        const revealViewportY = window.innerHeight * 0.20;
        const viewBoxHeight = svgLine.viewBox.baseVal.height;
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        let pixelsAboveReveal;

        if (scrollTop < 1) {
            pixelsAboveReveal = revealViewportY - dashedLineRect.top;
        } else {
            pixelsAboveReveal = Math.max(0, revealViewportY - dashedLineRect.top);
        }

        const svgUnitsPerPixel = viewBoxHeight / svgDynamicHeight;
        const maskYInSvgUnits = pixelsAboveReveal * svgUnitsPerPixel;
        maskRect.setAttribute('y', maskYInSvgUnits);
        maskRect.setAttribute('height', viewBoxHeight - maskYInSvgUnits);

        if (svgTipCounter) {
            const maskYForPosition = pixelsAboveReveal * svgUnitsPerPixel;
            const verticalProgress = maskYForPosition / viewBoxHeight;
            const distanceAlongPath = verticalProgress * pathTotalLength;
            
            const pointOnPath = pathElement.getPointAtLength(distanceAlongPath);
            
            const svgContainerRect = dashedLineContainer.getBoundingClientRect();
            const viewBoxWidth = svgLine.viewBox.baseVal.width;
            const svgXUnitsPerPixel = viewBoxWidth / svgLine.width.baseVal.value;
            
            const counterLeftPx = pointOnPath.x / svgXUnitsPerPixel;
            const counterTopPx = pointOnPath.y / svgUnitsPerPixel;

            svgTipCounter.style.left = `${counterLeftPx}px`;
            svgTipCounter.style.top = `${counterTopPx}px`;
            
            currentCounterY = dashedLineContainer.offsetTop + counterTopPx;
            
            const stateContainer1 = document.querySelector('.state-container-1');
            let fadeInTriggerY = -Infinity;
            if (stateContainer1) {
                const state1Rect = stateContainer1.getBoundingClientRect();
                fadeInTriggerY = state1Rect.top + (state1Rect.height / 1.3);
            }
            const counterY = dashedLineRect.top + counterTopPx;
            const isBelowStartTrigger = counterY > fadeInTriggerY;
            
            const stateContainer12 = document.querySelector('.state-container-12');
            let fadeOutTriggerY = Infinity;
            if (stateContainer12) {
                const state12Rect = stateContainer12.getBoundingClientRect();
                fadeOutTriggerY = state12Rect.top;
            }
            const isAboveEndTrigger = counterY < fadeOutTriggerY;

            const isLineOnScreen = dashedLineRect.bottom > -100 && dashedLineRect.top < window.innerHeight;
            
            const shouldBeVisible = isLineOnScreen && isBelowStartTrigger && isAboveEndTrigger;
            svgTipCounter.style.opacity = shouldBeVisible ? '1' : '0';
        }
    }

    function checkAndAnimatePopups() {
        const triggerThreshold = window.innerHeight * 0.20;
        document.querySelectorAll('.h2-popup').forEach(popup => {
            if (popup.classList.contains('visible')) return;
            const h2 = popup.nextElementSibling;
            if (!h2) return;
            const h2Rect = h2.getBoundingClientRect();
            if (h2Rect.bottom < 0 || h2Rect.top > window.innerHeight) return;
            const h2TriggerPoint = h2Rect.top + (h2Rect.height * 0.6);
            if (h2TriggerPoint > triggerThreshold) {
                popup.classList.add('visible');
                const altitudeValueElement = popup.querySelector('.altitude-value');
                if (altitudeValueElement) {
                    animateAltitude(altitudeValueElement);
                }
            }
        });
    }
    function handleOverscroll(event) {
        if (window.innerWidth > 1024 || document.body.classList.contains('noscroll') || isBouncingTop || isBouncingBottom) {
            return;
        }
        const touchY = event.touches[0].clientY;
        const isScrollingDown = touchY < lastTouchY;
        const isScrollingUp = touchY > lastTouchY;
        const atTop = window.pageYOffset === 0;
        if (atTop && isScrollingUp && topContentWrapper) {
            event.preventDefault();
            isBouncingTop = true;
            topContentWrapper.classList.add('pull-down-bounce-animation');
            setTimeout(() => {
                topContentWrapper.classList.remove('pull-down-bounce-animation');
                isBouncingTop = false;
            }, 600);
        }
        const atBottom = Math.ceil(window.scrollY + window.innerHeight) >= document.documentElement.scrollHeight;
        if (atBottom && isScrollingDown && landingPage) {
            event.preventDefault();
            isBouncingBottom = true;
            landingPage.classList.add('push-up-bounce-animation');
            setTimeout(() => {
                landingPage.classList.remove('push-up-bounce-animation');
                isBouncingBottom = false;
            }, 600);
        }
        lastTouchY = touchY;
    }
    function preventKeyboardJump(e) {
        if (isSlowing && scrollBlockingKeys.includes(e.key)) e.preventDefault();
    }
    
    window.onload = () => {
        if (landingPage) landingPage.scrollIntoView({ behavior: 'instant' });

        if (pathElement) {
            pathTotalLength = pathElement.getTotalLength();
        }

        checkpointsData.push({ y: 0, value: 0 });
        document.querySelectorAll('.state-container').forEach(container => {
            const valueElement = container.querySelector('.altitude-value');
            if(valueElement && valueElement.dataset.finalValue) {
                const value = parseInt(valueElement.dataset.finalValue, 10);
                checkpointsData.push({ y: container.offsetTop, value: value });
            }
        });
        checkpointsData.sort((a, b) => a.y - b.y);
        
        document.body.style.opacity = '1';
        lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
        scrollToTopBtn.classList.add('is-hidden');
        positionDashedLine();
        animateDashedLine();
        checkAndAnimatePopups();
        updateNavLayout();
        updateMainCounter();
    };

    window.addEventListener('resize', () => {
        positionDashedLine();
        animateDashedLine();
        checkAndAnimatePopups();
        updateNavLayout();
    });

    window.addEventListener('scroll', () => {
        animateDashedLine();
        checkAndAnimatePopups();
        updateMainCounter();
        
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (landingPage) {
            const anchorThreshold = 0.90;
            const bottomOfViewport = scrollTop + window.innerHeight;
            const topOfLandingPage = landingPage.offsetTop;
            const heightOfLandingPage = landingPage.offsetHeight;
            const triggerPoint = topOfLandingPage + (heightOfLandingPage * (1 - anchorThreshold));
            if (scrollTop < lastScrollTop && bottomOfViewport < triggerPoint) {
                navbar.classList.add('navbar--anchored');
                scrollToTopBtn.classList.add('raised');
            } else {
                navbar.classList.remove('navbar--anchored');
                scrollToTopBtn.classList.remove('raised');
            }
        }
        const scrollableHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const scrollFraction = scrollableHeight > 0 ? (scrollTop / scrollableHeight) : 0;
        if (scrollFraction < 0.5) {
            scrollToTopBtn.classList.remove('is-hidden');
        } else {
            scrollToTopBtn.classList.add('is-hidden');
        }
        lastScrollTop = (scrollTop <= 0) ? 0 : scrollTop;
    }, { passive: true });
    
    scrollToTopBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (landingPage) landingPage.scrollIntoView({ behavior: 'smooth' });
    });
    mobileMenuToggle.addEventListener('click', () => {
        navbar.classList.toggle('nav-open');
        document.body.classList.toggle('noscroll');
        scrollToTopBtn.classList.toggle('is-hidden-by-nav');
        const isExpanded = navbar.classList.contains('nav-open');
        mobileMenuToggle.setAttribute('aria-expanded', isExpanded);
        const icon = mobileMenuToggle.querySelector('i');
        icon.classList.toggle('fa-bars', !isExpanded);
        icon.classList.toggle('fa-times', isExpanded);
    });
    window.addEventListener('touchstart', (e) => {
        if (window.innerWidth <= 1024) {
            lastTouchY = e.touches[0].clientY;
        }
    }, { passive: true });
    window.addEventListener('touchmove', handleOverscroll, { passive: false });
    window.addEventListener('keydown', preventKeyboardJump, { passive: false });
    history.scrollRestoration = 'manual';
</script>
</body>
</html>